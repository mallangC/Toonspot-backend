generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int        @id @default(autoincrement())
  email           String     @unique
  password        String
  nickname        String     @unique
  isEmailVerified Boolean    @default(false) @map("is_email_verified")
  role            UserRole   @default(USER)
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  Posts           Post[]
  PostLikes       PostLike[]

  @@map("user")
}

enum UserRole {
  ADMIN
  USER
}

model Toon {
  id           Int          @id @default(autoincrement())
  toonId       Int          @map("toon_id")
  provider     ToonProvider
  title        String
  authors      String
  summary      String?
  genre        ToonGenre?
  rating       Float?
  status       ToonStatus
  isAdult      Boolean      @map("is_adult")
  isActive     Boolean      @default(true) @map("is_active")
  imageUrl     String       @map("image_url")
  pageUrl      String       @map("page_url")
  totalEpisode Int?         @map("total_episode")
  publishDays  String       @map("publish_days")
  // favoritesCount Int          @default(0) @map("favorites_count")
  // likesCount     Int          @default(0) @map("likes_count")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  @@unique([toonId, provider])
  @@map("toon")
}

enum ToonProvider {
  NAVER
  KAKAO_W
  KAKAO_P
}

enum ToonGenre {
  ROMANCE
  THRILLER
  ACTION
  DAILY
  COMEDY
  FANTASY
  DRAMA
  SPORTS
  WUXIA
  EMOTION
  ROMANCE_FANTASY
  BL
}

enum ToonStatus {
  ONGOING
  PAUSED
  FINISHED
}

model Post {
  id        Int        @id @default(autoincrement())
  title     String
  content   String     @db.Text
  status    PostStatus @default(PUBLISHED)
  viewCount Int        @default(0) @map("view_count")
  userId    Int        @map("user_id")
  likeCount Int        @default(0) @map("like_count")
  likes     PostLike[]
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("post")
}

enum PostStatus {
  PUBLISHED
  HIDDEN
  DELETED
}

model PostLike {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  postId    Int      @map("post_id")
  createdAt DateTime @default(now()) @map("created_at")

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@map("like")
}
